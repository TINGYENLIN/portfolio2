<!-- âœ… demoAPI0605.htmlï¼šSPA å°ˆç”¨å­é ï¼Œæ¨£å¼ä¸€è‡´ -->
<h2 style="text-align: center;">ğŸ“Š è³‡æ–™è¡¨æ“ä½œ</h2>

<div class="form-group">
  <button class="tab-btn" onclick="loadTable(apiemployee, container1)">é€è²¨å“¡åˆ—è¡¨</button>
  <button class="tab-btn" onclick="loadTable(apimember, container1)">æœƒå“¡æ¸…å–®</button>
  <button class="tab-btn" onclick="loadTable(apiorders, container1)">æ­·å²è¨‚å–®æŸ¥è©¢</button>
  <button class="tab-btn" onclick="loadTable(apiproduct2, container1)">ç”¢å“åˆ—è¡¨</button>
  <button class="tab-btn" onclick="loadTable(apilength, container1)">é•·åº¦</button>
  <button class="tab-btn" onclick="loadTable(apiweight, container1)">å¯¬åº¦</button>
</div>

<div id="tableContainer" style="margin-top: 20px;">è«‹é¸æ“‡ä¸Šæ–¹é …ç›®è¼‰å…¥è³‡æ–™...</div>

<script>
  const apiemployee = 'http://localhost:8000/api/1/employee';
  const apimember = 'http://localhost:8000/api/1/member';
  const apiorders = 'http://localhost:8000/api/1/orders';
  const apiproduct2 = 'http://localhost:8000/api/1/product2';
  const apilength = 'http://localhost:8000/api/1/length';
  const apiweight = 'http://localhost:8000/api/1/weight';

  const container1 = document.getElementById('tableContainer');

  function getTableNameFromUrl(url) {
    if (url.includes("employee")) return "employee";
    if (url.includes("member")) return "member";
    if (url.includes("orders")) return "orders";
    if (url.includes("product2")) return "product2";
    if (url.includes("length")) return "length";
    if (url.includes("weight")) return "weight";
    return "";
  }

  async function loadTable(url, todiv) {
    try {
      const resp = await fetch(url);
      if (!resp.ok) throw new Error(`HTTP éŒ¯èª¤: ${resp.status}`);
      const data = await resp.json();
      if (!Array.isArray(data) || data.length === 0) {
        todiv.textContent = 'æ²’æœ‰è³‡æ–™';
        return;
      }

      const tableName = getTableNameFromUrl(url);

      let table = '<table><thead><tr>';
      table += '<th>æ“ä½œ</th>';
      const keys = Object.keys(data[0]);
      keys.forEach(k => {
        table += `<th>${k}</th>`;
      });
      table += '</tr></thead><tbody>';

      data.forEach(row => {
        const rowWithExtra = JSON.stringify({ ...row, table: tableName, state: -1 });
        table += '<tr>';
        table += `<td><button class="tab-btn" style="background-color:#e74c3c;" onclick='updaterow(${rowWithExtra})'>åˆªé™¤</button></td>`;
        keys.forEach(k => {
          table += `<td>${row[k]}</td>`;
        });
        table += '</tr>';
      });
      table += '</tbody></table>';
      todiv.innerHTML = table;

    } catch (err) {
      todiv.textContent = 'è¼‰å…¥å¤±æ•—ï¼š' + err.message;
    }
  }

  function updaterow(returnbody) {
    fetch('http://localhost:8000/api/2/update', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(returnbody),
    })
    .then(res => {
      if (!res.ok) throw new Error('æ›´æ–°å¤±æ•—');

      const rowButtons = document.querySelectorAll('button');
      rowButtons.forEach(btn => {
        if (btn.textContent === 'åˆªé™¤') {
          const jsonData = btn.getAttribute('onclick');
          if (jsonData.includes(`"${returnbody.id}"`) || jsonData.includes(`:${returnbody.id}`)) {
            const row = btn.closest('tr');
            const cells = row.querySelectorAll('td');
            const headerCells = row.closest('table').querySelectorAll('th');
            headerCells.forEach((th, idx) => {
              if (th.textContent.trim().toLowerCase() === 'status') {
                cells[idx].textContent = '-1';
              }
            });
          }
        }
      });
    })
    .catch(err => {
      alert('æ›´æ–°å¤±æ•—ï¼š' + err.message);
    });
  }
</script>
